# W1 D03 (2025-08-28)

## ✅ 오늘 한 일

### BE
- **좌석 선점(Reservation) 로직 구현**
  - 왜? → 동시 예약 시 oversell 방지를 위해 DB만으로는 부족하다.
  - 그래서 → Redis + Lua 스크립트로 원자적 체크/설정을 구현.
  - 결과 → `POST /api/reservations`에서 201/409가 정확히 리턴되고 TTL로 자동 만료됨.

- **표준 오류 바디 + Trace-Id 노출**
  - 왜? → 장애 분석과 FE 사용자 메시지 개선을 위해.
  - 그래서 → `{ code, message, traceId }` 응답 구조 적용.
  - 결과 → FE 토스트로 바로 확인 가능, Dev 모드에서 Trace-Id 노출 확인.

### FE
- **좌석맵 SeatGrid → BE 연동**
  - 왜? → FE 좌석 상태와 BE DB/Redis 상태를 일치시켜야 oversell 방지 로직이 눈에 보인다.
  - 그래서 → React Query로 API 연동, AVAILABLE/HELD/SOLD 색상 반영.
  - 결과 → 좌석 상태가 UI에서 실시간 반영.

- **좌석 클릭 → 예약 호출**
  - 왜? → 단순 UI를 넘어서 BE 로직과 연결해야 기능이 의미가 있다.
  - 그래서 → 클릭 시 `POST /api/reservations` 호출, 성공=토스트+선택 유지, 실패=409 토스트.
  - 결과 → 동시 클릭 시 한 명만 성공, 나머지는 실패 메시지 확인.

- **카운트다운 HoldCountdown UI 추가**
  - 왜? → TTL이 지나면 자동 만료되므로 사용자에게 남은 시간 안내 필요.
  - 그래서 → expiresAt 기반으로 초 단위 카운트다운 컴포넌트 구현.
  - 결과 → "남은 시간: XXs" 표시 후 만료되면 사라짐.

### Infra/테스트
- **k6 스모크 테스트**
  - 왜? → 실제로 동시 요청을 흉내 내 검증해야 oversell 방지가 신뢰된다.
  - 그래서 → 5 VU, 10초 동안 같은 좌석 예약 → 201/409 섞여 나옴.
  - 결과 → checks 100% 통과, p95=17ms (SLO 충족).

---

## 📚 배운 점
- Redis는 캐시가 아니라 “실시간 상태 관리” 도구로 활용 가능.
- 409 Conflict도 도메인 로직상 정상 흐름일 수 있음.
- Trace-Id는 로그 추적 및 분산 트레이스 연결에 필수.

---

## 💡 느낀 점 / 회고
- Redis TTL+Lua로 문제를 단순하게 해결하는 접근이 인상 깊었다.
- FE는 낯설지만 API 계약 중심으로 이해하니 훨씬 수월했다.
- 성능 측정 도구(k6)를 써보면서 “초고동시성”이라는 과제의 현실성을 실감.

---

## 📊 검증 결과 (DoD)
- k6: checks 100% (201/409 정상), Trace-Id 헤더 확인, p95=17ms (<300ms)
- FE: 좌석 클릭 시 토스트/카운트다운 정상 표시
- BE: TTL 만료 시 좌석 자동 해제 확인

---

## 📸 결과물 캡처
![좌석맵 예약 성공/실패 + 카운트다운](./images/W01 D03 image1.png)

![K6 결과](./images/docs/images/W01 D03 image k6 result.png)
